---
title: "Tugas 1 Individu STA1382"
author: "Hana Faiza Amalina"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Pendahuluan

#### *Artifical Neural Network*

*Artificial Neural Network* (ANN) merupakan sebuah model komputasi yang terinspirasi dari cara kerja otak manusia dalam memproses informasi. Setiap unit pemrosesan atau neuron dalam ANN memiliki fungsi matematika yang digunakan untuk menghitung *output* berdasarkan *input* yang diterimanya. ANN melakukan proses interatif untuk menyesuaikan bobot koneksi antar-neuron, sehingga *output* yang dihasilkan semakin mendekati *output* yang diinginkan.

#### Data

Pada tugas ini, data yang digunakan berisi 75 jenis skema pinjaman yang telah diberi rating (penilaian) oleh para pelanggannya. Data ini terdiri atas 75 amatan dengan lima peubah sebagai berikut:

1.  Besar pinjaman (dalam juta rupiah)
2.  Lama pembayaran (dalam tahun)
3.  Tambahan bunga yang ditetapkan (dalam persen)
4.  Pembayaran per bulan (dalam 10000)
5.  Banyak *cashback* yang diterapkan pada skema tersebut

Tujuan penelitian ini adalah memprediksi rating skema pinjaman berdasarkan peubah-peubah tersebut dengan menggunakan NN.

### Penyiapan Data

```{r include=FALSE}
library(readr)
```

```{r}
dt <- read.csv("C:/Users/hanfai/portfolio/artificial neural network/data ann.csv")
head(dt)
```

#### Pengecekan *missing value*

```{r}
colSums(is.na(dt))
```

Tidak ada data yang hilang pada dataset yang akan digunakan, sehingga tidak diperlukan penanganan apapun pada tahap ini.

#### Partisi data

Pemodelan menggunakan *neural network* memerlukan pembagian data menjadi data latih dan data uji. Data latih digunakan untuk membangun model, sedangkan data uji digunakan untuk mengevaluasi model yang dibangun. Pada tugas ini, data dibagi dengan proporsi 0.7 untuk data latih dan 0.3 untuk data uji.

```{r include=FALSE}
library(caret)
```

```{r}
set.seed(123)

train.index <- createDataPartition(dt$rate, p = 0.7, list = FALSE)
train <- dt[train.index, ]
test <- dt[-train.index, ]
```

#### Standardisasi data

Standardisasi data dilakukan karena setiap peubah memiliki skala atau peubah yang berbeda. Standardisasi dilakukan menggunakan *z-score*. Proses ini dilakukan menggunakan fungsi `preProcess`.

```{r}
preprocessParams <- preProcess(train[, -6], method=c("range"))
train_X <- as.matrix(predict(preprocessParams, train[, -6]))
test_X <- as.matrix(predict(preprocessParams, test[, -6]))

train_y <- train[, 6]
test_y <- test[, 6]
```

### Pemodelan dengan NN

Model *neural network* dibuat dengan bantuan `library(keras)` melalui fungsi `keras_model_sequential()`. Pada model ini, terdapat tiga jenis layer, yaitu *input layer, hidden layer,* dan *output layer*.

-   *Input layer* berfungsi untuk menerima informasi dari luar. Neuron yang ada pada *layer* ini adalah sebanyak peubah penjelas pada data yang digunakan.

-   *Hidden layer* berfungsi untuk menghubungkan *layer input* dan *output.* Pada model ini, terdapat lima *hidden layer* dengan 100 neuron. Seluruh *layer* tersebut menggunakan fungsi aktivasi *rectified linier unit* (ReLU). Untuk menghindari overfitting, maka setiap *layer* ditambahkan parameter `dropout` dengan *rate =* 0.3.

-   *Output layer* berfungsi untuk mengeluarkan hasil pengolahan informasi. Pada model ini, *output layer* hanya memiliki satu neuron dan menggunakan fungsi aktivasi linier.

```{r include=FALSE}
library(keras)
library(tensorflow)
library(dplyr)
```

```{r message=FALSE, warning=FALSE}
model <- keras_model_sequential() %>%
  layer_dense(units = 100, activation = "relu", input_shape = ncol(train_X)) %>%
  layer_dropout(0.3) %>%
  layer_dense(units = 100, activation = "relu") %>%
  layer_dropout(0.3) %>%
  layer_dense(units = 100, activation = "relu") %>%
  layer_dropout(0.3) %>%
  layer_dense(units = 100, activation = "relu") %>%
  layer_dropout(0.3) %>%
  layer_dense(units = 100, activation = "relu") %>%
  layer_dropout(0.3) %>%
  layer_dense(units = 1, activation = "linear")
```

#### Kompilasi model

Kompilasi model dilakukan untuk menentukan beberapa parameter pelatihan model yang akan digunakan, seperti *loss function*, *optimizer*, dan *metrics*.

-   *Loss function* merupakan fungsi yang digunakan untuk mengukur seberapa bagus performa yang dihasilkan oleh model dalam melakukan prediksi terhadap target. *Loss function* yang digunakan pada model ini adalah *mean squared error* (MSE).

-   *Optimizer* merupakan metode yang digunakan dalam mengubah bobot untuk mengurangi *loss*. *Optimizer* yang digunakan pada model ini adalah *Adam optimizer.*

-   *Metrics* merupakan fungsi yang digunakan untuk menilai kinerja model. Fungsi *metrics* mirip dengan fungsi *loss function*, namun hasil evaluasi *metrics* tidak digunakan dalam pelatihan model. *Metrics* yang digunakan pada model ini adalam *mean squared error* dan *mean absolute error.*

```{r}
model %>% compile(
  loss = "mean_squared_error",
  optimizer = "adam",
  metrics = list("mean_squared_error", "mean_absolute_error")
)
```

#### Pelatihan model

Pelatihan model dilakukan menggunakan beberapa fungsi, seperti `epochs`, `batch_size`, dan `validation_split`.

-   `epochs` mengacu pada satu putaran pelatihan model pada seluruh data latih yang ada. Pada setiap iterasi, model dijalankan melalui seluruh data latih sebanyak satu kali dan parameter model diperbarui menggunakan algoritma optimasi yang sudah ditentukan.

-   `batch_size` merupakan jumlah sampel data yang dihitung dalam satu iterasi pada saat pelatihan model.

-   `validation_split` merupakan proporsi sampel acak yang akan diambil dari kumpulan data asli dan digunakan untuk analisis.

```{r message=FALSE, warning=FALSE}
history <- model %>% fit(
  train_X, train_y,
  shuffle = T,
  epochs = 50,
  batch_size = 32,
  validation_split = 0.2
)
```

```{r}
plot(history)
```

Plot di atas menunjukkan hasil pelatihan model. Terlihat bahwa data latih dengan data validasi memiliki selisih yang semakin dekat seiring dengan bertambanhnya `epochs`. Bahkan di beberapa `epochs` terlihat bahwa data latih dan data validasi saling berimpit. Maka dari itu, dapat dikatakan bahwa model yang dibangun sudah cukup baik.

```{r}
print(model)
```

Setiap *layer* memiliki *output* dan bentuknya ditampilkan pada kolom `Output Shape` . *Output* dari setiap *layer* akan menjadi *input* bagi *layer* berikutnya. Kolom `Param #` menampilkan jumlah parameter yang dilatih untuk setiap *layer*. Jumlah total parameter ditunjukkan di bagian akhir, baik yang dapat dilatih maupun tidak. Pada model ini, seluruh parameter yang dihasilkan dapat dilatih.

#### Evaluasi Model

Model yang dihasilkan kemudian dievaluasi lagi menggunakan tiga pengukuran, yaitu *root mean square error* (RMSE), R-Squared, dan *mean absolute error* (MAE).

1.  RMSE menunjukkan besarnya tingkat kesalahan prediksi. Semakin kecil nilainya, maka hasil prediksi akan semakin akurat.
2.  R-Squared (dalam persen) menunjukkan seberapa besar keragaman yang dapat dijelaskan oleh model. Semakin mendekati 100%, maka model yang dibagun semakin bagus.
3.  MAE digunakan untuk mengukur tingkat keakuratan suatu model prediksi. Nilai MAE merepresentasikan rata-rata kesalahan mutlak antara hasil prediksi dengan nilai aktual. Semakin keci nilainya, maka hasil prediksi akan semakin akurat.

```{r include=FALSE}
keras_test <- model %>% predict(test_X)
```

```{r}
postResample(keras_test[,1], test$rate)
```

Nilai RMSE dan MAE yang dihasilkan melalui evaluasi model menggunakan data uji dapat dibilang tidak besar. Nilai R-Squared yang dihasilkan pun sudah cukup besar, yaitu 0.7144259. Artinya, sebanyak 71.44% keragaman peubah penjelas dapat dijelaskan oleh model, sedangkan sisanya dijelaskan oleh peubah lain.

### Prediksi

```{r message=FALSE, warning=FALSE}
prediksi <- predict(model, test_X)
results <- data.frame(Data = test_y, Prediksi = prediksi)
results
```

Tabel di atas menunjukkan perbandingan antara data aktual dengan hasil prediksi. Pada beberapa amatan, prediksi yang dihasilkan tidak begitu jauh dari data sebenarnya. Namun, masih ada amatan yang memiliki selisih cukup besar antara hasil prediksi dengan data sebenarnya.

### Kesimpulan

Model yang dibangun merupakan model NN dengan tujuh *layer,* yaitu satu *input layer* dengan lima neuron, lima *hidden neuron* dengan masing-masing seratus neuron, dan satu *output layer* dengan satu neuron. Hasil evaluasi model menunjukkan bahwa model sudah baik dengan nilai R-Squared yang cukup besar. Meskipun terdapat beberapa perbedaan yang cukup jauh antara nilai sebenarnya dengan hasil prediksi, model ini dapat digunakan untuk memprediksi rating skema pinjaman berdasarkan besar pinjaman, lama pembayaran, tambahan bunga yang ditetapkan, pembayaran per bulan, dan banyak *cashbak* yang diterapkan pada setiap skema.
